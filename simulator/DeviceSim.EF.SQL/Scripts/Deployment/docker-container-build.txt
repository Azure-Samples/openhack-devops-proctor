############### Build and Push Docker Container to ACR ###############
declare buildFlavor="Debug"
declare resourceGroupName="team1rgxs76"
declare imageTag="latest"
declare registryName="team1acrxs76"


cd ../../DeviceSim.EF.SQL/DeviceSim.EF.SQL

######Build DotNet application
dotnet build -c $buildFlavor -o ./bin

cd ..



######Login to Azure Container Registry
### Get the acr repository id to tag image with.

ACR_ID=`az acr list -g $resourceGroupName --query "[].{acrLoginServer:loginServer}" --output json | jq .[].acrLoginServer | sed 's/\"//g'`

### Retrieve acr credential

acrPassword=$(az acr credential show -n $registryName -o json |jq -r '[.passwords[0].value]|.[]')

### Complete Docker Login

docker login $ACR_ID -u $registryName -p $acrPassword

### Set Image Tag

TAG=$ACR_ID"/devopsoh/simulator:"$imageTag

### Docker Build

docker build . -t $TAG

### Push Image to acr

docker push $TAG

### confirm
echo -e "\nSuccessfully pushed image: "$TAG

